<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceNow Auth Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            /* Updated to a dark theme for the glowing particles */
            --bg-dark: #0f172a; 
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --input-focus: rgba(79, 70, 229, 0.15);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            color: var(--text-main);
            overflow: hidden; /* Prevents scrollbars from the canvas */
        }

        /* The canvas sits fixed in the background */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1; 
        }

        .auth-container { 
            /* Glassmorphism effect so particles glow behind the card */
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(12px);
            padding: 40px; 
            border-radius: 16px; 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255,255,255,0.4); 
            width: 100%; 
            max-width: 380px; 
            box-sizing: border-box;
            z-index: 1; /* Keeps card above the canvas */
        }

        .logo-placeholder { text-align: center; margin-bottom: 24px; }
        .logo-placeholder svg { width: 48px; height: 48px; color: var(--primary); }
        h2 { text-align: center; font-size: 24px; font-weight: 700; margin: 0 0 8px 0; }
        p.subtitle { text-align: center; color: var(--text-muted); font-size: 14px; margin: 0 0 24px 0; }
        .input-group { margin-bottom: 16px; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #475569; }
        
        input { 
            width: 100%; padding: 12px 16px; background-color: #f8fafc;
            border: 1px solid var(--border); border-radius: 8px; 
            font-size: 15px; font-family: 'Inter', sans-serif;
            box-sizing: border-box; transition: all 0.2s ease;
        }

        input:focus { outline: none; border-color: var(--primary); background-color: #fff; box-shadow: 0 0 0 4px var(--input-focus); }
        input::placeholder { color: #94a3b8; }
        
        button { 
            width: 100%; padding: 14px; background-color: var(--primary); color: white; 
            border: none; border-radius: 8px; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: all 0.2s ease; margin-top: 8px;
        }

        button:hover { background-color: var(--primary-hover); transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2); }
        button:active { transform: translateY(0); }
        
        .toggle-text { text-align: center; margin-top: 24px; font-size: 14px; color: var(--text-muted); }
        .toggle-text a { color: var(--primary); font-weight: 600; text-decoration: none; cursor: pointer; transition: color 0.2s; }
        .toggle-text a:hover { color: var(--primary-hover); text-decoration: underline; }
        
        .status-message { margin-top: 16px; font-size: 14px; border-radius: 6px; display: none; }
        .alert-error { display: block; background-color: #fef2f2; color: #ef4444; padding: 12px; border: 1px solid #fecaca; }
        .alert-success { display: block; background-color: #f0fdf4; color: #22c55e; padding: 12px; border: 1px solid #bbf7d0; }

        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
    </style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<div class="auth-container">
    
    <div id="loginSection" class="fade-in">
        <div class="logo-placeholder">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
        </div>
        <h2>Welcome back</h2>
        <p class="subtitle">Enter your details to access the portal.</p>
        
        <form id="loginForm">
            <div class="input-group">
                <label for="loginUserId">User ID</label>
                <input type="text" id="loginUserId" placeholder="e.g. jdoe" required>
            </div>
            <div class="input-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="••••••••" required>
            </div>
            <button type="submit">Sign In</button>
        </form>
        <div id="loginStatus" class="status-message"></div>
        
        <div class="toggle-text">
            Don't have an account? <a onclick="toggleForms('signup')">Sign up</a>
        </div>
    </div>

    <div id="signupSection" class="hidden fade-in">
        <h2>Create an account</h2>
        <p class="subtitle">Join the ServiceNow portal today.</p>
        
        <form id="signupForm">
            <div style="display: flex; gap: 12px;">
                <div class="input-group" style="flex: 1;">
                    <label for="regFirstName">First Name</label>
                    <input type="text" id="regFirstName" placeholder="John" required>
                </div>
                <div class="input-group" style="flex: 1;">
                    <label for="regLastName">Last Name</label>
                    <input type="text" id="regLastName" placeholder="Doe" required>
                </div>
            </div>
            <div class="input-group">
                <label for="regEmail">Email Address</label>
                <input type="email" id="regEmail" placeholder="john.doe@company.com" required>
            </div>
            <div class="input-group">
                <label for="regUserId">Desired User ID</label>
                <input type="text" id="regUserId" placeholder="jdoe" required>
            </div>
            <div class="input-group">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" placeholder="Create a strong password" required>
            </div>
            <button type="submit">Create Account</button>
        </form>
        <div id="signupStatus" class="status-message"></div>
        
        <div class="toggle-text">
            Already have an account? <a onclick="toggleForms('login')">Sign in</a>
        </div>
    </div>

</div>

<script>
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');

    let particlesArray = [];
    const colors = ['rgba(0, 240, 255, 0.8)', 'rgba(255, 77, 109, 0.8)']; // Cyan and Pink/Red

    // Set canvas to full screen
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Track mouse position
    let mouse = { x: null, y: null, radius: 150 };

    window.addEventListener('mousemove', function(event) {
        mouse.x = event.x;
        mouse.y = event.y;
    });

    window.addEventListener('resize', function() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initParticles();
    });

    class Particle {
        constructor(x, y, directionX, directionY, size, color) {
            this.x = x;
            this.y = y;
            this.directionX = directionX;
            this.directionY = directionY;
            this.size = size;
            this.color = color;
            this.baseX = this.x;
            this.baseY = this.y;
            this.density = (Math.random() * 30) + 1;
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2, false);
            // Add a glowing effect to the particles
            ctx.shadowBlur = 15;
            ctx.shadowColor = this.color;
            ctx.fillStyle = this.color;
            ctx.fill();
        }

        update() {
            // Check canvas borders to bounce
            if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
            if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;

            // Collision detection with mouse (Cursor interaction)
            let dx = mouse.x - this.x;
            let dy = mouse.y - this.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            
            // If the mouse is close, push the particles away
            if (distance < mouse.radius) {
                let forceDirectionX = dx / distance;
                let forceDirectionY = dy / distance;
                let force = (mouse.radius - distance) / mouse.radius;
                let directionX = forceDirectionX * force * this.density;
                let directionY = forceDirectionY * force * this.density;
                
                this.x -= directionX;
                this.y -= directionY;
            } else {
                // Return to normal movement
                if (this.x !== this.baseX) {
                    let dx = this.x - this.baseX;
                    this.x -= dx / 10;
                }
                if (this.y !== this.baseY) {
                    let dy = this.y - this.baseY;
                    this.y -= dy / 10;
                }
            }

            // Move the particle
            this.x += this.directionX;
            this.y += this.directionY;
            this.draw();
        }
    }

    // Initialize particle array
    function initParticles() {
        particlesArray = [];
        let numberOfParticles = (canvas.height * canvas.width) / 9000;
        
        for (let i = 0; i < numberOfParticles; i++) {
            let size = (Math.random() * 5) + 1;
            let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
            let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
            let directionX = (Math.random() * 2) - 1;
            let directionY = (Math.random() * 2) - 1;
            let color = colors[Math.floor(Math.random() * colors.length)];

            particlesArray.push(new Particle(x, y, directionX, directionY, size, color));
        }
    }

    // Animation Loop
    function animateParticles() {
        requestAnimationFrame(animateParticles);
        ctx.clearRect(0, 0, innerWidth, innerHeight);

        for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].update();
        }
    }

    initParticles();
    animateParticles();
</script>

<script>
    function toggleForms(formToShow) {
        const loginSection = document.getElementById('loginSection');
        const signupSection = document.getElementById('signupSection');
        const loginStatus = document.getElementById('loginStatus');
        const signupStatus = document.getElementById('signupStatus');

        loginStatus.className = 'status-message';
        signupStatus.className = 'status-message';
        loginStatus.innerHTML = '';
        signupStatus.innerHTML = '';

        if (formToShow === 'signup') {
            loginSection.classList.add('hidden');
            signupSection.classList.remove('hidden');
            signupSection.classList.remove('fade-in');
            void signupSection.offsetWidth; 
            signupSection.classList.add('fade-in');
        } else {
            signupSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            loginSection.classList.remove('fade-in');
            void loginSection.offsetWidth; 
            loginSection.classList.add('fade-in');
        }
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusDiv = document.getElementById('loginStatus');
        const btn = e.target.querySelector('button');
        
        const originalBtnText = btn.innerText;
        btn.innerText = 'Signing in...';
        btn.style.opacity = '0.8';
        statusDiv.className = 'status-message'; 
        
        const loginData = {
            userId: document.getElementById('loginUserId').value,
            password: document.getElementById('loginPassword').value
        };

        try {
            const response = await fetch('http://localhost:3000/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(loginData)
            });

            const result = await response.json();
            
            if (response.ok) {
                statusDiv.innerHTML = `<strong>Success!</strong> Welcome back, ${result.user}.`;
                statusDiv.className = 'status-message alert-success';
            } else {
                statusDiv.innerHTML = `<strong>Error:</strong> ${result.error}`;
                statusDiv.className = 'status-message alert-error';
            }
        } catch (error) {
            statusDiv.innerHTML = '<strong>Connection Error:</strong> Unable to reach the server.';
            statusDiv.className = 'status-message alert-error';
        } finally {
            btn.innerText = originalBtnText;
            btn.style.opacity = '1';
        }
    });

    document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const statusDiv = document.getElementById('signupStatus');
        const btn = e.target.querySelector('button');
        
        const originalBtnText = btn.innerText;
        btn.innerText = 'Creating account...';
        btn.style.opacity = '0.8';
        statusDiv.className = 'status-message';
        
        const userData = {
            firstName: document.getElementById('regFirstName').value,
            lastName: document.getElementById('regLastName').value,
            email: document.getElementById('regEmail').value,
            userId: document.getElementById('regUserId').value,
            password: document.getElementById('regPassword').value
        };

        try {
            const response = await fetch('http://localhost:3000/api/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(userData)
            });

            const result = await response.json();
            
            if (response.ok) {
                statusDiv.innerHTML = `<strong>Success!</strong> Account created securely.`;
                statusDiv.className = 'status-message alert-success';
                document.getElementById('signupForm').reset();
                setTimeout(() => { toggleForms('login'); }, 2000);
            } else {
                statusDiv.innerHTML = `<strong>Error:</strong> ${result.error}`;
                statusDiv.className = 'status-message alert-error';
            }
        } catch (error) {
            statusDiv.innerHTML = '<strong>Connection Error:</strong> Unable to reach the server.';
            statusDiv.className = 'status-message alert-error';
        } finally {
            btn.innerText = originalBtnText;
            btn.style.opacity = '1';
        }
    });
</script>

</body>
</html>